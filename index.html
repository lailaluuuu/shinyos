<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShinyOS Â· Learn Like It's A Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- Favicon for various devices -->
  <!-- Standard favicon -->
  <link rel="icon" type="image/png" href="images/favicon.png" />
  <link rel="shortcut icon" href="images/favicon.png" />
  <!-- Apple Touch Icons (iOS) -->
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="images/favicon.png" />
  <link rel="apple-touch-icon" sizes="57x57" href="images/favicon.png" />
  <link rel="apple-touch-icon" href="images/favicon.png" />
  <!-- Android/Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="images/favicon.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="images/favicon.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="images/favicon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png" />
  <!-- Theme and tile colors -->
  <meta name="theme-color" content="#060712" />
  <meta name="msapplication-TileColor" content="#060712" />
  <meta name="msapplication-TileImage" content="images/favicon.png" />
  <meta name="msapplication-config" content="none" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Loading screen for mobile -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-content">
      <div class="loading-emoji">
        <div class="rocket-container">
          <div class="hedgehog-rider">
            <!-- Use emoji *or* your hedgehog image -->
            <!-- Emoji version: -->
            <span class="hedgehog-emoji">ğŸ¦”</span>

            <!-- Image version (replace src with your icon path):
            <img src="images/hedgehog-icon.png" alt="Hedgehog" class="hedgehog-img" />
            -->
          </div>
          <div class="rocket">ğŸš€</div>
        </div>
      </div>
      <div class="loading-text">App loading...</div>
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  </div>

  <div class="app">
    <!-- Top bar -->
    <header class="top-bar">
      <button type="button" class="profile-menu-btn" id="profileMenuBtn" aria-label="Open profile menu"><span class="profile-menu-dots" aria-hidden="true"><span class="dot"></span><span class="dot"></span><span class="dot"></span></span></button>
      <div class="brand">
        <div class="logo-mark">â—</div>
        <div class="logo-text">
          <span class="logo-main">ShinyOS</span>
          <span class="logo-sub">operating system for your brain</span>
        </div>
      </div>
      <div class="top-bar-right">
        <!-- Rotating status message: "Welcome back, {username} ğŸ¦”" or "You're #{rank} this week ğŸ‘€ğŸ”¥" -->
        <div class="status-message" id="statusMessage" aria-live="polite"></div>
        <button type="button" class="leaderboard-btn" id="leaderboardBtn" aria-label="Open leaderboard">ğŸ‘‘</button>

        <!-- Login button (logout moved to profile menu) -->
        <button type="button" class="auth-btn" id="loginBtn">Login</button>

        <div class="top-bar-metrics">
          <div class="metric metric--level">
            <span class="metric-label">Level</span>
            <span class="metric-value" id="levelValue">3</span>
          </div>
          <div class="metric metric--xp">
            <span class="metric-label">XP</span>
            <span class="metric-value" id="xpValue">120</span>
            <div class="xp-progress-mini">
              <div class="xp-progress-fill-mini" id="xpProgressMini"></div>
            </div>
          </div>
          <div class="metric metric--streak">
            <span class="metric-label">streak</span>
            <span class="metric-value">ğŸ”¥ <span id="streakValue">3</span></span>
          </div>
        </div>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
          <span class="theme-icon">ğŸŒ™</span>
        </button>
      </div>
    </header>

    <!-- Horizontal category picker (below stats, Duolingo-style) -->
    <div class="category-picker-wrap" id="categoryPickerWrap">
      <div class="category-picker" id="categoryPicker" role="tablist" aria-label="Lesson categories">
        <!-- Category cards injected by app.js -->
      </div>
    </div>

    <!-- Main layout -->
    <main class="layout">
      <!-- Left: world / subjects -->
      <section class="world-panel">
        <div class="world-header">
          <h2>ğŸ—ºï¸ Learning Atlas</h2>
          <p class="world-subtitle">
            Pick any topic and start learning. Skill is repetition, not magic.
          </p>
        </div>

        <div class="world-map">
          <!-- Era ring -->
          <div class="era-pill">
            <span class="era-dot"></span>
            <span id="eraPillLabel">Foundations Era</span>
          </div>

          <!-- Breadcrumb navigation -->
          <div class="breadcrumb" id="breadcrumb">
            <button class="breadcrumb-item is-active" onclick="window.showCategories && window.showCategories()">ğŸ—ºï¸ Categories</button>
            <span class="breadcrumb-separator" id="breadcrumbSeparator" style="display: none;"> â†’ </span>
            <span class="breadcrumb-current" id="breadcrumbCurrent"></span>
          </div>

          <!-- Category folders (shown by default) -->
          <div class="world-grid" id="categoryGrid">
            <!-- Categories will be dynamically populated by JS -->
          </div>

          <!-- Subject grid (shown when category is selected) -->
          <div class="world-grid is-hidden" id="subjectGrid">
            <!-- Subjects will be dynamically populated by JS -->
          </div>
        </div>
      </section>

      <!-- Right: lesson / journal -->
      <section class="lesson-panel">
        <div class="lesson-tabs">
          <button class="tab is-active" data-tab="lesson">Lesson</button>
          <button class="tab" data-tab="journal">ğŸ†</button>
        </div>

        <div class="lesson-card" id="lessonCard">
          <div class="lesson-chip-row">
            <span class="chip chip--subject" id="subjectChip">Economics Â· Markets</span>
            <span class="chip chip--unit" id="unitChip">Unit: Planned Economies</span>
          </div>

          <h1 class="lesson-title" id="lessonTitle">Planned Economies</h1>
          <p class="lesson-subtitle" id="lessonSubtitle">
            When the state takes the steering wheel of the market.
          </p>

          <div class="lesson-progress">
            <div class="lesson-progress-top">
              <span>Lesson progress</span>
              <span id="lessonProgressLabel">1 / 4</span>
            </div>
            <div class="lesson-progress-bar">
              <div class="lesson-progress-fill" id="lessonProgressFill" style="width: 25%;"></div>
            </div>
          </div>

          <!-- Content container -->
          <div class="lesson-body">
            <div id="lessonContent">
              <!-- Filled by JS -->
            </div>
          </div>

          <!-- Quiz area -->
          <div class="quiz-block" id="quizBlock">
            <!-- Filled by JS -->
          </div>

          <!-- Footer: XP etc -->
          <div class="lesson-footer">
            <div class="footer-left">
              <span class="xp-pill">â­ +<span id="pendingXp">0</span> XP</span>
              <span class="hint-text" id="hintText">Tap an answer to check your understanding.</span>
            </div>
            <div class="footer-buttons">
              <button class="back-btn" id="backBtn" onclick="window.goBackDirect && window.goBackDirect();" style="display: none;">â† Back</button>
              <button class="next-btn" id="nextBtn">Continue</button>
            </div>
          </div>
        </div>

        <!-- Journal placeholder -->
        <div class="journal-panel is-hidden" id="journalPanel">
          <h2>Your Atlas Page</h2>
          <p class="journal-text" id="journalText">
            This is where your stamps, diagrams, and one-line notes for this topic will live.
          </p>
        </div>
      </section>
    </main>
  </div>

  <!-- Achievement notification -->
  <div class="achievement-popup" id="achievementPopup">
    <div class="achievement-icon">ğŸ†</div>
    <div class="achievement-content">
      <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
      <div class="achievement-desc" id="achievementDesc">Knowledge Seeker</div>
    </div>
  </div>

  <!-- Level up overlay -->
  <div class="level-up-overlay" id="levelUpOverlay">
    <div class="level-up-content">
      <div class="level-up-number" id="levelUpNumber">4</div>
      <div class="level-up-text">Level Up!</div>
      <button class="level-up-continue">Continue</button>
    </div>
  </div>

  <!-- Confetti canvas -->
  <canvas id="confettiCanvas" class="confetti-canvas"></canvas>

  <!-- Creature Reaction System -->
  <div id="creature-reaction-root"></div>

  <!-- First-time username prompt -->
  <div class="username-modal is-hidden" id="usernameModal" role="dialog" aria-modal="true" aria-labelledby="usernameModalTitle">
    <div class="username-modal-backdrop"></div>
    <div class="username-modal-content">
      <h2 class="username-modal-title" id="usernameModalTitle">Choose your username âœ¨</h2>
      <form id="usernameForm" class="username-form">
        <input type="text" id="usernameInput" class="username-input" placeholder="e.g. hedgehog42" maxlength="20" autocomplete="username" required />
        <p class="username-error" id="usernameError" aria-live="polite"></p>
        <button type="submit" class="username-submit" id="usernameSubmit" disabled>Let's go âœ¨</button>
      </form>
    </div>
  </div>

  <!-- Leaderboard modal -->
  <div class="leaderboard-modal is-hidden" id="leaderboardModal" role="dialog" aria-modal="true" aria-labelledby="leaderboardModalTitle">
    <div class="leaderboard-modal-backdrop"></div>
    <div class="leaderboard-modal-content">
      <div class="leaderboard-modal-header">
        <h2 class="leaderboard-modal-title" id="leaderboardModalTitle">ğŸ† Leaderboard</h2>
        <button type="button" class="leaderboard-modal-close" id="leaderboardModalClose" aria-label="Close leaderboard">Ã—</button>
      </div>
      <div class="leaderboard-list" id="leaderboardList">
        <!-- Leaderboard query & render fills this -->
      </div>
    </div>
  </div>

  <!-- Profile menu modal (three-dots â†’ Logout + tagline) -->
  <div class="profile-modal is-hidden" id="profileModal" role="dialog" aria-modal="true" aria-labelledby="profileModalTitle">
    <div class="profile-modal-backdrop" id="profileModalBackdrop"></div>
    <div class="profile-modal-content">
      <div class="profile-modal-header">
        <p class="profile-modal-tagline" id="profileModalTitle">operating system for your brain</p>
        <button type="button" class="profile-modal-close" id="profileModalClose" aria-label="Close menu">Ã—</button>
      </div>
      <div class="profile-modal-body">
        <button type="button" class="profile-modal-logout is-hidden" id="profileModalLogout">Logout</button>
      </div>
    </div>
  </div>

  <script type="module" src="firebase.js"></script>
  <script src="creatures.js"></script>
  <script src="app.js"></script>
</body>
</html>

