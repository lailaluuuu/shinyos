<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ShinyOS â€“ Lesson Template Maker</title>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      background: #0f0f14;
      color: #f5f5f7;
      padding: 24px;
      max-width: 900px;
      margin: auto;
    }

    h1 {
      margin-bottom: 4px;
    }

    input, textarea, button, select {
      width: 100%;
      margin-top: 8px;
      margin-bottom: 16px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }

    select {
      background: #1b1b22;
      color: #f5f5f7;
      cursor: pointer;
    }

    textarea {
      min-height: 120px;
      font-family: inherit;
    }

    button {
      background: #7c7cff;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background: #6b6bef;
    }

    button.secondary {
      background: #4a4aaa;
    }

    button.secondary:hover {
      background: #3a3a99;
    }

    button.danger {
      background: #e74c3c;
    }

    button.danger:hover {
      background: #c0392b;
    }

    pre {
      background: #1b1b22;
      padding: 16px;
      border-radius: 12px;
      white-space: pre-wrap;
      max-height: 500px;
      overflow-y: auto;
    }

    .hint {
      opacity: 0.7;
      font-size: 13px;
      margin-bottom: 20px;
    }

    .section {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #7c7cff;
    }

    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
      font-size: 13px;
      font-weight: 500;
    }

    .slide-item {
      background: rgba(255, 255, 255, 0.08);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 2px solid rgba(124, 124, 255, 0.3);
      cursor: move;
      position: relative;
    }

    .slide-item.dragging {
      opacity: 0.5;
      border-color: #7c7cff;
    }

    .slide-item.drag-over {
      border-color: #7c7cff;
      background: rgba(124, 124, 255, 0.15);
    }

    .slide-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .slide-type-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      background: rgba(124, 124, 255, 0.3);
    }

    .slide-type-badge.quiz {
      background: rgba(255, 107, 107, 0.3);
    }

    .slide-controls {
      display: flex;
      gap: 8px;
    }

    .slide-controls button {
      width: auto;
      padding: 6px 12px;
      margin: 0;
      font-size: 12px;
    }

    .drag-handle {
      cursor: move;
      font-size: 18px;
      opacity: 0.5;
      padding: 0 8px;
    }

    .drag-handle:hover {
      opacity: 1;
    }

    .add-slide-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .add-slide-buttons button {
      flex: 1;
    }
  </style>
</head>

<body>

  <h1>ðŸ¦” Lesson Template Maker</h1>
  <p class="hint">Fill this in calmly. Copy the output into <code>data.js</code> in the appropriate subject array.</p>

  <div class="section">
    <div class="section-title">Basic Info</div>
    
    <label>Subject</label>
    <input id="subject" placeholder="finance" />

    <label>Lesson ID</label>
    <input id="lessonId" placeholder="pattern-hunger" />

    <label>Title</label>
    <input id="title" placeholder="The Pattern Hunger" />

    <label>Subtitle</label>
    <input id="subtitle" placeholder="Why your brain hates randomness" />

    <label>Image URL (optional)</label>
    <input id="imageUrl" placeholder="images/pattern-hunger-intro.png" />

    <label>Image Alt Text (optional)</label>
    <input id="imageAlt" placeholder="Pattern Hunger introduction" />
  </div>

  <div class="section">
    <div class="section-title">Slides (Drag to Reorder)</div>
    <p class="hint">Add content slides and quizzes in any order. Drag to rearrange!</p>
    
    <div id="slidesContainer"></div>

    <div class="add-slide-buttons">
      <button onclick="addContentSlide()" class="secondary">+ Add Content Slide</button>
      <button onclick="addQuizSlide()" class="secondary">+ Add Quiz</button>
    </div>
  </div>

  <button onclick="generate()">Generate Lesson</button>

  <h2>Output</h2>
  <pre id="output"></pre>

  <script>
    let slides = [];
    let slideIdCounter = 0;
    let draggedElement = null;

    function createSlideId() {
      return `slide-${slideIdCounter++}`;
    }

    function addContentSlide() {
      const slide = {
        id: createSlideId(),
        type: 'content',
        title: '',
        paragraphs: '',
        imageUrl: '',
        imageAlt: ''
      };
      slides.push(slide);
      renderSlides();
    }

    function addQuizSlide() {
      const slide = {
        id: createSlideId(),
        type: 'quiz',
        question: '',
        optionA: '',
        optionB: '',
        optionC: '',
        optionD: '',
        correctAnswer: '',
        explanation: ''
      };
      slides.push(slide);
      renderSlides();
    }

    function removeSlide(id) {
      slides = slides.filter(s => s.id !== id);
      renderSlides();
    }

    function updateSlideData(id, field, value) {
      const slide = slides.find(s => s.id === id);
      if (slide) {
        slide[field] = value;
      }
    }

    function renderSlides() {
      const container = document.getElementById('slidesContainer');
      container.innerHTML = '';

      slides.forEach((slide, index) => {
        const slideEl = document.createElement('div');
        slideEl.className = 'slide-item';
        slideEl.draggable = true;
        slideEl.dataset.slideId = slide.id;

        slideEl.addEventListener('dragstart', handleDragStart);
        slideEl.addEventListener('dragend', handleDragEnd);
        slideEl.addEventListener('dragover', handleDragOver);
        slideEl.addEventListener('drop', handleDrop);
        slideEl.addEventListener('dragenter', handleDragEnter);
        slideEl.addEventListener('dragleave', handleDragLeave);

        if (slide.type === 'content') {
          slideEl.innerHTML = `
            <div class="slide-header">
              <div>
                <span class="drag-handle">â‹®â‹®</span>
                <span class="slide-type-badge">Content Slide ${index + 1}</span>
              </div>
              <div class="slide-controls">
                <button onclick="removeSlide('${slide.id}')" class="danger">Delete</button>
              </div>
            </div>
            
            <label>Title</label>
            <input value="${escapeHtml(slide.title)}" 
                   onchange="updateSlideData('${slide.id}', 'title', this.value)"
                   placeholder="Your brain hates randomness ðŸŽ²" />

            <label>Paragraphs (one per line)</label>
            <textarea onchange="updateSlideData('${slide.id}', 'paragraphs', this.value)"
                      placeholder="Your brain would rather believe a false pattern...
This isn't a flaw. It's survival wiring.
Your visual cortex processes information...">${escapeHtml(slide.paragraphs)}</textarea>

            <label>Image URL (optional)</label>
            <input value="${escapeHtml(slide.imageUrl)}"
                   onchange="updateSlideData('${slide.id}', 'imageUrl', this.value)"
                   placeholder="https://images.unsplash.com/photo-..." />

            <label>Image Alt (optional)</label>
            <input value="${escapeHtml(slide.imageAlt)}"
                   onchange="updateSlideData('${slide.id}', 'imageAlt', this.value)"
                   placeholder="Image description" />
          `;
        } else if (slide.type === 'quiz') {
          slideEl.innerHTML = `
            <div class="slide-header">
              <div>
                <span class="drag-handle">â‹®â‹®</span>
                <span class="slide-type-badge quiz">Quiz ${index + 1}</span>
              </div>
              <div class="slide-controls">
                <button onclick="removeSlide('${slide.id}')" class="danger">Delete</button>
              </div>
            </div>
            
            <label>Question</label>
            <input value="${escapeHtml(slide.question)}"
                   onchange="updateSlideData('${slide.id}', 'question', this.value)"
                   placeholder="Why does the brain prefer a false pattern over no pattern?" />

            <label>Option A</label>
            <input value="${escapeHtml(slide.optionA)}"
                   onchange="updateSlideData('${slide.id}', 'optionA', this.value)"
                   placeholder="Because it likes drama" />

            <label>Option B</label>
            <input value="${escapeHtml(slide.optionB)}"
                   onchange="updateSlideData('${slide.id}', 'optionB', this.value)"
                   placeholder="Because humans are irrational" />

            <label>Option C</label>
            <input value="${escapeHtml(slide.optionC)}"
                   onchange="updateSlideData('${slide.id}', 'optionC', this.value)"
                   placeholder="Because it evolved for survival, not accuracy" />

            <label>Option D</label>
            <input value="${escapeHtml(slide.optionD)}"
                   onchange="updateSlideData('${slide.id}', 'optionD', this.value)"
                   placeholder="Because emotions override logic" />

            <label>Correct Answer</label>
            <select onchange="updateSlideData('${slide.id}', 'correctAnswer', this.value)">
              <option value="">-- Select --</option>
              <option value="a" ${slide.correctAnswer === 'a' ? 'selected' : ''}>A</option>
              <option value="b" ${slide.correctAnswer === 'b' ? 'selected' : ''}>B</option>
              <option value="c" ${slide.correctAnswer === 'c' ? 'selected' : ''}>C</option>
              <option value="d" ${slide.correctAnswer === 'd' ? 'selected' : ''}>D</option>
            </select>

            <label>Explanation</label>
            <textarea onchange="updateSlideData('${slide.id}', 'explanation', this.value)"
                      placeholder="Missing a real threat once = death...">${escapeHtml(slide.explanation)}</textarea>
          `;
        }

        container.appendChild(slideEl);
      });
    }

    function handleDragStart(e) {
      draggedElement = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
    }

    function handleDragEnd(e) {
      this.classList.remove('dragging');
      document.querySelectorAll('.slide-item').forEach(item => {
        item.classList.remove('drag-over');
      });
    }

    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    function handleDragEnter(e) {
      if (this !== draggedElement) {
        this.classList.add('drag-over');
      }
    }

    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }

      if (draggedElement !== this) {
        const draggedId = draggedElement.dataset.slideId;
        const targetId = this.dataset.slideId;
        
        const draggedIndex = slides.findIndex(s => s.id === draggedId);
        const targetIndex = slides.findIndex(s => s.id === targetId);
        
        const [draggedSlide] = slides.splice(draggedIndex, 1);
        slides.splice(targetIndex, 0, draggedSlide);
        
        renderSlides();
      }

      return false;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    function generate() {
      const subject = document.getElementById("subject").value.trim();
      const lessonId = document.getElementById("lessonId").value.trim();
      const title = document.getElementById("title").value.trim();
      const subtitle = document.getElementById("subtitle").value.trim();
      const imageUrl = document.getElementById("imageUrl").value.trim();
      const imageAlt = document.getElementById("imageAlt").value.trim();

      if (!subject || !lessonId || !title) {
        alert("Please fill in at least: Subject, Lesson ID, and Title");
        return;
      }

      const sections = [];

      // Add intro slide if image provided
      if (imageUrl) {
        sections.push({
          type: "intro",
          subject: subject,
          title: title,
          subtitle: subtitle || "",
          imageUrl: imageUrl,
          imageAlt: imageAlt || title + " introduction"
        });
      }

      // Add all slides in order
      slides.forEach(slide => {
        if (slide.type === 'content') {
          if (slide.title && slide.paragraphs) {
            const contentSlide = {
              type: "content",
              title: slide.title,
              paragraphs: slide.paragraphs
                .split("\n")
                .map(p => p.trim())
                .filter(p => p.length > 0)
            };

            if (slide.imageUrl) {
              contentSlide.imageUrl = slide.imageUrl;
              contentSlide.imageAlt = slide.imageAlt || slide.title;
            }

            sections.push(contentSlide);
          }
        } else if (slide.type === 'quiz') {
          if (slide.question && slide.optionA && slide.optionB && slide.optionC && slide.optionD && slide.correctAnswer) {
            const options = [
              { id: "a", text: slide.optionA, correct: slide.correctAnswer === "a" },
              { id: "b", text: slide.optionB, correct: slide.correctAnswer === "b" },
              { id: "c", text: slide.optionC, correct: slide.correctAnswer === "c" },
              { id: "d", text: slide.optionD, correct: slide.correctAnswer === "d" }
            ];

            sections.push({
              type: "quiz",
              question: slide.question,
              options: options,
              explanation: slide.explanation || ""
            });
          }
        }
      });

      // Build final lesson object
      const lesson = {
        id: lessonId,
        subject: subject,
        type: "lesson",
        title: title,
        subtitle: subtitle || "",
        imageUrl: imageUrl || undefined,
        imageAlt: imageAlt || undefined,
        sections: sections
      };

      // Clean up undefined values
      Object.keys(lesson).forEach(key => {
        if (lesson[key] === undefined || lesson[key] === "") {
          delete lesson[key];
        }
      });

      const code = JSON.stringify(lesson, null, 2);

      document.getElementById("output").textContent = code;
    }

    // Initialize with one content slide
    addContentSlide();
  </script>

</body>
</html>